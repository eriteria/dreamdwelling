{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<style>
    #map {
        width: 100%;
        height: 500px;
        border: 1px solid #ddd;
    }

    #debug {
        margin-top: 12px;
        font-family: monospace;
    }

    .warn {
        background: #fff3cd;
        color: #664d03;
        padding: 8px;
        border: 1px solid #ffe69c;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1>Map Test Page</h1>
    <div id="map"></div>
    <div id="debug"></div>
</div>
{% endblock %}

{% block extrajs %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const debug = document.getElementById('debug');
        const token = '{{ mapbox_access_token|default:"" }}';
        const styleUrl = '{{ mapbox_style|default:"mapbox://styles/mapbox/streets-v12" }}';
        function log(msg) { debug.innerHTML += '<div>' + msg + '</div>'; }

        if (!token) {
            document.getElementById('map').innerHTML = '<div class="warn">Missing MAPBOX_ACCESS_TOKEN</div>';
            log('No Mapbox token provided');
            return;
        }

        mapboxgl.accessToken = token;
        const map = new mapboxgl.Map({
            container: 'map',
            style: styleUrl,
            center: [-98.5795, 39.8283],
            zoom: 4
        });
        map.on('load', () => {
            log('Map loaded');
            new mapboxgl.Marker()
                .setLngLat([-98.5795, 39.8283])
                .setPopup(new mapboxgl.Popup().setHTML('<strong>Test Marker</strong>'))
                .addTo(map);
            log('Test marker added');
        });
    });
</script>
{% endblock %}
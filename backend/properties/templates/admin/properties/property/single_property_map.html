{% extends "admin/base_site.html" %}
{% load i18n static humanize %}

{% block extrastyle %}
{{ block.super }}
<style>
    #map {
        width: 100%;
        height: 600px;
        margin-top: 20px;
    }

    .property-details {
        margin-top: 20px;
        padding: 15px;
        background-color: #f9f9f9;
        border: 1px solid #e5e5e5;
        border-radius: 4px;
    }

    .property-details h2 {
        margin-top: 0;
    }

    .property-details dl {
        display: grid;
        grid-template-columns: max-content auto;
        grid-gap: 0.5em 1em;
    }

    .property-details dt {
        font-weight: bold;
        text-align: right;
    }

    .property-details dd {
        margin: 0;
    }

    .back-button {
        margin-top: 20px;
    }
</style>
{% endblock %}

{% block content %}
<h1>{{ property.title }}</h1>

<div class="row">
    <div class="col-md-8">
        <div id="map"></div>
    </div>
    <div class="col-md-4">
        <div class="property-details">
            <h2>Property Details</h2>
            <dl>
                <dt>Address:</dt>
                <dd>{{ property.address_line1 }}, {{ property.city }}, {{ property.state }} {{ property.zipcode }}</dd>

                <dt>Price:</dt>
                <dd>${{ property.price|intcomma }}</dd>

                <dt>Status:</dt>
                <dd>{{ property.status }}</dd>

                <dt>Listing Type:</dt>
                <dd>{{ property.listing_type }}</dd>

                <dt>Bedrooms:</dt>
                <dd>{{ property.bedrooms }}</dd>

                <dt>Bathrooms:</dt>
                <dd>{{ property.bathrooms }}</dd>

                <dt>Square Feet:</dt>
                <dd>{{ property.square_feet|intcomma }}</dd>

                <dt>Year Built:</dt>
                <dd>{{ property.year_built }}</dd>

                <dt>Lot Size:</dt>
                <dd>{{ property.lot_size|default:"N/A" }}</dd>
            </dl>

            <div class="actions">
                <a href="{% url 'admin:properties_property_change' property.id %}" class="button">Edit Property</a>
            </div>
        </div>

        <div class="back-button">
            <a href="{% url 'admin:properties_property_changelist' %}" class="button">Back to Property List</a>
            <a href="{% url 'admin:property_google_map' %}" class="button">View All Properties</a>
        </div>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key|default:'' }}"></script>
<script>
    // Map styles
    const mapStyles = {{ map_style|default: '[]' | safe }};

    // Initialize the map when the page loads
    window.onload = function () {
        initMap();
    };

    function initMap() {
        const propertyPosition = {
            lat: {{ property.latitude }
    },
    lng: { { property.longitude } }
        };

    // Create map centered on the property
    const map = new google.maps.Map(document.getElementById('map'), {
        center: propertyPosition,
        zoom: 15,
        styles: mapStyles
    });

    // Add marker for the property
    const marker = new google.maps.Marker({
        position: propertyPosition,
        map: map,
        title: '{{ property.title }}',
        animation: google.maps.Animation.DROP
    });

    // Add info window with property details
    const infoWindow = new google.maps.InfoWindow({
        content: `
                <div>
                    <h3>{{ property.title }}</h3>
                    <p>{{ property.address_line1 }}, {{ property.city }}, {{ property.state }}</p>
                    <p><strong>${{ property.price | intcomma }}</strong></p>
                    <p>{{ property.bedrooms }} bd | {{ property.bathrooms }} ba | {{ property.square_feet|intcomma }} sqft</p>
                </div>
            `
    });

    // Open info window when marker is clicked
    marker.addListener('click', function () {
        infoWindow.open(map, marker);
    });

    // Open info window by default
    infoWindow.open(map, marker);
    }
</script>
{% endblock %}